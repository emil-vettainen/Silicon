@using Presentation.WebApp.ViewModels.Courses

@model IEnumerable<CourseViewModel>

@{
    ViewData["Title"] = "Courses";
}

<section class="courses">
    <div class="container">

        <div class="courses-bread">
            <a href="#"><i class="fa-regular fa-house me-2"></i>Home</a>
            <i class="fa-regular fa-angles-right"></i>
            <a href="#">Courses</a>

        </div>

        <div class="courses-options">
            <h1 class="pb-3">Courses</h1>

            <div class="form-options">


                <form method="get" asp-action="FilterByCategory" asp-controller="Courses">
                    <select class="form-select" id="categorySelect" name="category" onchange="this.form.submit()">
                        <option selected>All categories</option>
                        <option value="BestSeller">Best Seller</option>
                        <option value="2">Two</option>
                        <option value="3">Three</option>
                    </select>

                </form>
               



@* 
                <select class="form-select" id="categorySelect" onchange="filterCourses()">
                    <option selected>All categories</option>
                    <option value="1">One</option>
                    <option value="2">Two</option>
                    <option value="3">Three</option>
                </select> *@

             @*    <script>
                    function filterCourses() {
                        var category = document.getElementById('categorySelect').value;
                        fetch(`/Courses/FilterByCategory?category=${category}`)
                        .then(response => response.json())
                        .then(data => )
                    }

                </script> *@


                <div class="input-group">
                    <input type="text" class="form-control" placeholder="Search courses">
                    <button class="btn btn-outline-secondary search" type="button" >
                        <i class="fa-regular fa-magnifying-glass"></i>
                    </button>
                </div>

            </div>
        </div>

        <div class="courses-grid">

            @foreach (var course in Model)
            {
                <article class="course-card">
                    <a asp-action="Details" asp-controller="Courses" asp-route-id="@course.Id">
                        <img class="course-img" src="@course.CourseImageUrl" alt="@course.CourseTitle">
                        @if (course.IsBestseller)
                        {
                            <p class="best-seller text-s">Best Seller</p>
                        }
                        <div class="card-text">
                            <div class="testar">
                                <h5>@course.CourseTitle</h5>
                                <p class="text-s">By @course.Author.FullName</p>
                                @if (course.Price.DiscountPrice > 0)
                                {
                                    <div class="course-price">
                                        <p class="text-lg discount-price">$@course.Price.DiscountPrice.Value.ToString("F2")</p>
                                        <p class="text-lg original-price">$@course.Price.OriginalPrice.ToString("F2")</p>
                                    </div>
                                }
                                else
                                {
                                    <p class="text-lg">$@course.Price.OriginalPrice.ToString("F2")</p>
                                }
                                <span class="border border-1"></span>
                            </div>

                            <div class="card-info">
                                <i class="fa-regular fa-clock">
                                    <p class="text-s">@course.Included.HoursOfVideo hours</p>
                                </i>
                                <i class="fa-regular fa-thumbs-up">
                                    <p class="text-s">@course.Rating.InProcent% (@(course.Rating.InNumbers / 1000m)K)</p>
                                </i>
                            </div>

                        </div>
                    </a>
                    @if (ViewContext.RouteData.Values["Controller"]!.ToString() == "Courses") {
                      
                      @*   <form method="post" asp-action="Favorite" asp-controller="Courses">
                            <input type="hidden" name="id" value="@course.Id"></input>
                            <button type="submit" class="favorite" data-bs-trigger="hover" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Favorite" data-bs-custom-class="custom-tooltip"><i class="fa-solid fa-bookmark"></i></button>
                        </form> *@

                        <button onclick="saveCourse('@course.Id')" class="favorite" data-bs-trigger="hover" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Favorite" data-bs-custom-class="custom-tooltip"><i class="fa-solid fa-bookmark"></i></button>

                        <script>

                            function saveCourse(courseId) {
                                fetch(`/Courses/Favorite?id=${courseId}`, {
                                    method: 'POST',
                                    headers: {
                                        'X-Requested-With' : 'XMLHttpRequest'
                                    },
                               
                                  
                                })
                                .then(response => {
                                    if (response.ok) {
                                        showAlert('Success', 'Sparad')
                                    } else {
                                        alert("något fick fel");
                                    }
                                   
                                })
                            }


                            function showAlert(type, message) {
                                var modal = document.getElementById('alertModal');
                                var modalBody = modal.querySelector('.modal-body');
                                var modalHeader = modal.querySelector('.modal-header');

                                modalHeader.classList = `modal-header alert alert-${type}`;
                                modalBody.textContent = message;

                                var alertModal = new bootstrap.Modal(modal);
                                alertModal.show();

                            }

                        </script>
                        
                       
                    }
                    else
                    {
                        <a asp-action="Remove" asp-controller="Account" asp-route-id="@course.Id" class="favorite" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Remove" data-bs-custom-class="custom-tooltip"><i class="fa-solid fa-bookmark"></i></a>
                    }

                </article>
            }


           
        </div>

    </div>
</section>


<section class="work-with-us">

    <div class="container grid-12">
        <div class="content">
            <p class="text-l">Ready to get started?</p>
            <h1>Take Your <span class="skills">Skills</span> to the Next Level</h1>
            <a class="btn-theme-small" href="#">Work with us</a>
        </div>
        <img src="~/images/courses/illustration.svg" alt="Work with us">
    </div>

</section>

